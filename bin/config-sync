#!/usr/bin/env php
<?php

declare(strict_types=1);

use MohammadAlavi\ConfigSync\ConfigSyncPlugin;

require __DIR__ . '/../vendor/autoload.php';

$root = getcwd();
$target = $root . '/config-sync.json';

if (file_exists($target)) {
    fwrite(STDERR, "config-sync.json already exists â€” aborting.\n");
    exit(1);
}

// Collect the defaults published by the plugin
$config = ConfigSyncPlugin::DEFAULT_CONFIG;

$schemaRelative = ConfigSyncPlugin::SCHEMA_URL;

// Prepend $schema for IDE autocompletion + linting
$output = array_merge([
    '$schema' => $schemaRelative,
], $config);

file_put_contents(
    $target,
    json_encode($output, JSON_THROW_ON_ERROR | JSON_PRETTY_PRINT | JSON_UNESCAPED_SLASHES) . PHP_EOL,
);

echo "Created config-sync.json with default values. You can now override whatever you need.\n";
